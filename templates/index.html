<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Burp Smart Eye</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="/static/logo.png" alt="Logo">
    </div>
    <h1>๐ Burp Smart Eye</h1>
    <p>๐ก๏ธ ุฃุฏุงุฉ ุชุญููู ุฐููุฉ ููุชูุงุฑูุฑ ูุงูุชุดุงู ุงูุซุบุฑุงุช</p>
    <p style="font-size: 14px; color: #888;">ููููู ุฑูุน ุชูุงุฑูุฑ XML ูู Burp Suite ุฃู ูููุงุช ููุฏ (HTML, JS, PHP, PY) ูุชุญููููุง ุชููุงุฆููุง</p>

    {% if message %}
      <div class="alert">{{ message }}</div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
      <input type="file" name="file" required>
      <button type="submit">๐ค ุฑูุน ุงูุชูุฑูุฑ</button>
    </form>

    {% if results %}
      <h2>๐ ูุชุงุฆุฌ ุงูุชุญููู</h2>

      <!-- ููุฎุต ุงูุฎุทูุฑุฉ -->
      <div class="summary-box">
        <h3>๐ ููุฎุต ูุณุชููุงุช ุงูุฎุทูุฑุฉ</h3>
        <table class="summary-table">
          <thead>
            <tr>
              <th>โ๏ธ ุนุงููุฉ</th>
              <th>โ๏ธ ูุชูุณุทุฉ</th>
              <th>โ๏ธ ููุฎูุถุฉ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ summary.High }}</td>
              <td>{{ summary.Medium }}</td>
              <td>{{ summary.Low }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      {% for r in results %}
        <div class="card {{ r.severity|lower }}">
          <h3>{{ r.name }}</h3>
          <ul>
            <li><strong>ุงูุฎุทูุฑุฉ:</strong> {{ r.severity }}</li>
            <li><strong>ุงููุตู:</strong> {{ r.description or 'ูุง ููุฌุฏ' }}</li>
            <li><strong>ุงูุญู ุงูุชูููุฏู:</strong> {{ r.solution or 'โ' }}</li>
            <li><strong>ุงููุณุงุฑ:</strong> {{ r.path or 'ุบูุฑ ูุญุฏุฏ' }}</li>
            <li><strong>ุชูุงุตูู:</strong> {{ r.details or 'โ' }}</li>
            {% if r.references %}
              <li><strong>ูุฑุงุฌุน:</strong>
                <ul>
                  {% for ref in r.references %}
                    <li><a href="{{ ref }}" target="_blank">{{ ref }}</a></li>
                  {% endfor %}
                </ul>
              </li>
            {% endif %}
          </ul>

          <!-- ุฒุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู -->
          <button type="button" class="ai-button" data-vuln="{{ r.name }}" data-severity="{{ r.severity|lower }}">
            ๐ค ุชูููุฏ ุดุฑุญ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
          </button>
          <div class="ai-result-container" style="margin-top: 15px;"></div>
        </div>
      {% endfor %}

      <form method="POST" action="/download_excel">
  <button type="submit">๐ ุชุญููู ุงูุชูุฑูุฑ ุงูุญุงูู (Excel)</button>
</form>

<form method="POST" action="/download_excel_append">
  <button type="submit">๐ ุชุญููู ุงูุชูุฑูุฑ ุงูุชุฑุงููู (Excel ููุญูุฏ)</button>
</form>
{% endif %}


  <!-- ุณูุฑุจุช ุงูุดุฑุญ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".ai-button").forEach(btn => {
        btn.addEventListener("click", async function () {
          const vulnName = this.getAttribute("data-vuln");
          const severity = this.getAttribute("data-severity");
          const resultBox = this.nextElementSibling;

          resultBox.innerHTML = `
            <div class="card ${severity}">
              โณ ุฌุงุฑู ุชูููุฏ ุงูุดุฑุญ ุจุงุณุชุฎุฏุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู...
            </div>
          `;

          try {
            const response = await fetch("/ai_explain", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded"
              },
              body: `vuln_name=${encodeURIComponent(vulnName)}`
            });

            const data = await response.json();

            resultBox.innerHTML = `
          <div class="card ${severity}">
          <strong>๐ง ุดุฑุญ ุงูุฐูุงุก ุงูุงุตุทูุงุนู:</strong><br>
          <small style="color: #ccc; display: block; margin-bottom: 10px;">
          ูุฐุง ุงูุดุฑุญ ููุชุฑุญ ุจูุงุณุทุฉ ูููุฐุฌ ุฐูุงุก ุตูุงุนู ููุฏ ูุง ูููู ุฏููููุง ุจูุณุจุฉ 100%.
          </small>
          <div style="white-space: pre-line;">${data.explanation}</div>
          </div>
            `;

            
          } catch (e) {
            resultBox.innerHTML = `
              <div class="card ${severity}">
                โ ูุดู ูู ุชูููุฏ ุงูุดุฑุญุ ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.
              </div>
            `;
          }
        });
      });
    });
  </script>
</body>
</html>
